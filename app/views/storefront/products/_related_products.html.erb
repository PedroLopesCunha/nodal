<div class="mt-5 pt-4 border-top">
  <h4 class="mb-4"><%= t('storefront.products.show.related_products') %></h4>
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
    <% @related_products.each do |product| %>
      <div class="col">
        <%= link_to product_path(org_slug: params[:org_slug], id: product), class: "text-decoration-none" do %>
          <div class="card h-100 product-card">
            <% discount_info = @related_product_discounts[product.id] %>
            <% if product.photo_attached? %>
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                <%= image_tag product.photo, style: "max-height: 180px; max-width: 100%; object-fit: contain;" %>
              </div>
            <% else %>
              <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                <i class="fa-solid fa-image fa-3x text-muted"></i>
              </div>
            <% end %>
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <span class="badge bg-secondary-subtle text-secondary"><%= product.primary_category&.name %></span>
              </div>
              <h6 class="card-title text-dark mb-0"><%= product.name %></h6>
            </div>
            <div class="card-footer bg-white border-top-0">
              <div class="d-flex justify-content-between align-items-center">
                <% if discount_info && discount_info[:has_discount] %>
                  <div class="price-with-discount">
                    <span class="original-price text-muted text-decoration-line-through small">
                      <%= humanized_money_with_symbol(discount_info[:base_price]) %>
                    </span>
                    <span class="discounted-price h6 mb-0 text-success">
                      <%= humanized_money_with_symbol(discount_info[:final_price]) %>
                    </span>
                  </div>
                <% elsif product.variable? %>
                  <span class="h6 mb-0 text-primary"><%= product.display_price %></span>
                <% else %>
                  <span class="h6 mb-0 text-primary"><%= humanized_money_with_symbol(product.price) %></span>
                <% end %>
                <small class="text-muted"><%= product.unit_description %></small>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
