<header style="position: sticky; top: 0; z-index: 1020; background: #fff;">
  <% if browsing_as_member? %>
    <div class="py-2 text-center small" style="background-color: #0dcaf0; color: #000;">
      <i class="fa-solid fa-eye me-1"></i>
      <%= t('storefront.member_browse.preview_banner') %>
      <%= link_to t('storefront.member_browse.return_to_dashboard'), bo_path(org_slug: current_organisation.slug), class: "ms-2", style: "color: #000; text-decoration: underline;" %>
    </div>
  <% end %>
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom" style="position: relative !important; top: auto !important; left: auto !important; height: auto !important; padding: 0.5rem 1rem !important;">
    <div class="container">
      <%= link_to products_path(org_slug: params[:org_slug]), class: "navbar-brand fw-bold d-flex align-items-center gap-1" do %>
        <% if current_organisation&.logo&.attached? %>
          <%= image_tag current_organisation.logo, style: "max-height: 32px;", alt: current_organisation.name %>
        <% else %>
          <span class="logo-icon"><%= current_organisation&.name&.first&.upcase || 'N' %></span>
          <span class="logo-text"><%= current_organisation&.name || 'odal' %></span>
        <% end %>
      <% end %>

      <%# Mobile cart icon + hamburger (visible only on mobile) %>
      <div class="d-flex align-items-center d-lg-none">
        <% if current_customer %>
          <%= link_to cart_path(org_slug: params[:org_slug]), class: "btn btn-outline-primary border-0 position-relative me-2 #{'active' if controller_name == 'carts'}" do %>
            <i class="fa-solid fa-cart-shopping"></i>
            <% if cart_line_item_count > 0 %>
              <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill cart-badge">
                <%= cart_line_item_count %>
              </span>
            <% end %>
          <% end %>
        <% end %>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#customerNav">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse" id="customerNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <%= link_to t('storefront.navbar.products'), products_path(org_slug: params[:org_slug]), class: "nav-link #{'active' if controller_name == 'products'}" %>
          </li>
          <% unless browsing_as_member? %>
            <li class="nav-item">
              <%= link_to t('storefront.navbar.orders'), orders_path(org_slug: params[:org_slug]), class: "nav-link #{'active' if controller_name == 'orders'}" %>
            </li>
          <% end %>
          <% if current_organisation.has_contact_info? %>
            <li class="nav-item">
              <%= link_to t('storefront.navbar.contact'), contact_path(org_slug: params[:org_slug]), class: "nav-link #{'active' if controller_name == 'contacts'}" %>
            </li>
          <% end %>
        </ul>

        <div class="d-flex align-items-center gap-4">
          <% if current_customer %>
            <!-- Cart Icon (desktop only, mobile cart is in header) -->
            <%= link_to cart_path(org_slug: params[:org_slug]), class: "btn btn-outline-primary border-0 position-relative d-none d-lg-inline-flex #{'active' if controller_name == 'carts'}" do %>
              <i class="fa-solid fa-cart-shopping"></i>
              <% if cart_line_item_count > 0 %>
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill cart-badge">
                  <%= cart_line_item_count %>
                </span>
              <% end %>
              <% if has_order_discounts? %>
                <span class="position-absolute badge rounded-circle bg-success d-flex align-items-center justify-content-center" style="width: 16px; height: 16px; font-size: 8px; bottom: -4px; left: -4px;" title="<%= t('storefront.navbar.order_discounts_available') %>">
                  <i class="fa-solid fa-percent"></i>
                </span>
              <% end %>
            <% end %>
            <span class="text-muted small d-none d-lg-inline">
              <i class="fa-regular fa-building me-1"></i>
              <%= current_customer.company_name %>
            </span>
            <div class="dropdown">
              <button class="btn btn-sm dropdown-toggle user-dropdown-btn text-muted" type="button" data-bs-toggle="dropdown">
                <i class="fa-regular fa-user me-1"></i>
                <%= current_customer.contact_name %>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <%= link_to account_path(org_slug: params[:org_slug]), class: "dropdown-item" do %>
                    <i class="fa-solid fa-user-gear me-2"></i><%= t('storefront.navbar.account') %>
                  <% end %>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <%= link_to destroy_customer_session_path(org_slug: params[:org_slug]), class: "dropdown-item", data: { turbo_method: :delete } do %>
                    <i class="fa-solid fa-right-from-bracket me-2"></i><%= t('storefront.navbar.sign_out') %>
                  <% end %>
                </li>
              </ul>
            </div>
          <% elsif browsing_as_member? %>
            <!-- Member browsing info (no cart) -->
            <span class="badge bg-info me-2">
              <i class="fa-solid fa-user-tie me-1"></i><%= t('storefront.member_browse.staff_badge') %>
            </span>
            <span class="text-muted small">
              <%= "#{current_member.first_name} #{current_member.last_name}" %>
            </span>
          <% end %>
        </div>
      </div>
    </div>
  </nav>
  <% if current_organisation&.free_shipping_enabled? %>
    <div class="py-2 text-center small fw-medium" style="background-color: #d1e7dd; color: #0f5132;">
      <i class="fa-solid fa-truck me-1"></i>
      <%= t('storefront.free_shipping.banner', amount: humanized_money_with_symbol(current_organisation.free_shipping_threshold)) %>
    </div>
  <% end %>
</header>
