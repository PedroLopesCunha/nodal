<% content_for :bo_main_content do %>

<!-- Sticky Header -->
<div class="bo-page-header">
  <div class="d-flex justify-content-between align-items-start">
    <div>
      <h1><%= t('bo.pricing.index.title') %></h1>
      <p><%= t('bo.pricing.index.subtitle') %></p>
    </div>
    <div class="bo-page-actions">
      <%= link_to new_bo_customer_product_discount_path(params[:org_slug]), class: "btn btn-primary" do %>
        <i class="fa-solid fa-plus"></i> <%= t('bo.pricing.custom_pricing.add_custom_price') %>
      <% end %>
    </div>
  </div>
</div>

<!-- Page Body -->
<div class="bo-page-body">
  <!-- Search Card -->
  <div class="card mb-4">
    <div class="card-body">
      <%= form_with url: bo_customer_product_discounts_path(params[:org_slug]), method: :get, class: "d-flex align-items-center" do %>
        <div class="input-group flex-grow-1 me-3">
          <span class="input-group-text bg-white border-end-0">
            <i class="fa-solid fa-magnifying-glass text-muted"></i>
          </span>
          <%= text_field_tag :query,
                params[:query],
                class: "form-control border-start-0",
                placeholder: t('bo.pricing.custom_pricing.search_placeholder')
          %>
        </div>
        <button type="submit" class="btn btn-outline-secondary">
          <i class="fa-solid fa-magnifying-glass"></i> <%= t('bo.common.actions.search') %>
        </button>
      <% end %>
    </div>
  </div>

  <!-- Discounts Table -->
  <div class="card">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th><%= t('bo.pricing.custom_pricing.table.client') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.product') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.base_price') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.custom_price') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.discount') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.effective_date') %></th>
          <th><%= t('bo.pricing.custom_pricing.table.actions') %></th>
        </tr>
      </thead>
      <tbody>
        <% @discounts.each do |discount| %>
          <tr>
            <td>
              <div class="fw-semibold"><%= discount.customer.company_name %></div>
              <small class="text-muted">C<%= discount.customer.id.to_s.rjust(3, '0') %></small>
            </td>
            <td><%= discount.product.name %></td>
            <td><%= humanized_money_with_symbol(discount.product.price) %></td>
            <td>
              <% custom_price = discount.product.price * (1 - discount.discount_percentage) %>
              <%= humanized_money_with_symbol(custom_price) %>
            </td>
            <td>
              <span class="badge rounded-pill bg-success-subtle text-success">
                -<%= number_to_percentage(discount.discount_percentage * 100, precision: 1) %>
              </span>
            </td>
            <td><%= discount.valid_from.strftime("%Y-%m-%d") %></td>
            <td>
              <div class="d-flex gap-2">
                <%= link_to edit_bo_customer_product_discount_path(params[:org_slug], discount), class: "text-muted", title: t('bo.common.actions.edit') do %>
                  <i class="fa-solid fa-pen-to-square"></i>
                <% end %>
                <%= link_to bo_customer_product_discount_path(params[:org_slug], discount), class: "text-danger", title: t('bo.common.actions.delete'), data: { turbo_method: :delete, turbo_confirm: t('bo.common.confirm.delete_discount') } do %>
                  <i class="fa-solid fa-trash"></i>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<% end %>
