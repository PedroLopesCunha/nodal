<% content_for :bo_main_content do %>

<!-- Sticky Header -->
<div class="bo-page-header">
  <div class="d-flex justify-content-between align-items-start">
    <div class="d-flex align-items-center gap-3">
      <%= link_to bo_product_path(params[:org_slug], @product), class: "text-muted" do %>
        <i class="fa-solid fa-arrow-left"></i>
      <% end %>
      <div>
        <h1><%= t('bo.product_variants.index.title') %></h1>
        <p><%= @product.name %></p>
      </div>
    </div>
    <div class="bo-page-actions d-flex gap-2">
      <%= link_to configure_variants_bo_product_path(params[:org_slug], @product), class: "btn btn-outline-primary" do %>
        <i class="fa-solid fa-sliders"></i> <%= t('bo.product_variants.index.configure') %>
      <% end %>
      <%= link_to new_bo_product_variant_path(params[:org_slug], @product), class: "btn btn-primary" do %>
        <i class="fa-solid fa-plus"></i> <%= t('bo.common.actions.add_new') %>
      <% end %>
    </div>
  </div>
</div>

<!-- Page Body -->
<div class="bo-page-body">
  <div class="card">
    <div class="card-body">
      <% if @variants.empty? %>
        <div class="text-center py-5">
          <i class="fa-solid fa-cubes fa-3x text-muted mb-3"></i>
          <h5 class="text-muted"><%= t('bo.product_variants.index.no_variants') %></h5>
          <p class="text-muted"><%= t('bo.product_variants.index.no_variants_hint') %></p>
          <div class="d-flex gap-2 justify-content-center">
            <%= link_to configure_variants_bo_product_path(params[:org_slug], @product), class: "btn btn-outline-primary" do %>
              <i class="fa-solid fa-sliders"></i> <%= t('bo.product_variants.index.configure_and_generate') %>
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th style="width: 50px;"></th>
                <th><%= t('bo.product_variants.index.variant') %></th>
                <th><%= t('bo.product_variants.index.sku') %></th>
                <th><%= t('bo.product_variants.index.price') %></th>
                <th><%= t('bo.product_variants.index.stock') %></th>
                <th><%= t('bo.product_variants.index.status') %></th>
                <th style="width: 100px;"></th>
              </tr>
            </thead>
            <tbody>
              <% @variants.each do |variant| %>
                <tr>
                  <td>
                    <% if variant.effective_photo.present? %>
                      <%= image_tag variant.effective_photo.variant(resize_to_limit: [40, 40]), class: "rounded" %>
                    <% else %>
                      <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                        <i class="fa-solid fa-image text-muted"></i>
                      </div>
                    <% end %>
                  </td>
                  <td>
                    <strong><%= variant.option_values_string.presence || t('bo.product_variants.index.default_variant') %></strong>
                    <% if variant.is_default? %>
                      <span class="badge bg-info ms-1"><%= t('bo.product_variants.index.default') %></span>
                    <% end %>
                    <br>
                    <small class="text-muted"><%= variant.name %></small>
                  </td>
                  <td>
                    <code><%= variant.sku.presence || '-' %></code>
                  </td>
                  <td>
                    <%= variant.price&.format %>
                  </td>
                  <td>
                    <% if variant.track_stock? %>
                      <span class="<%= variant.in_stock? ? 'text-success' : 'text-danger' %>">
                        <%= variant.stock_quantity %>
                      </span>
                    <% else %>
                      <span class="text-muted"><%= t('bo.product_variants.index.unlimited') %></span>
                    <% end %>
                  </td>
                  <td>
                    <% if variant.available? %>
                      <span class="badge bg-success"><%= t('bo.common.status.active') %></span>
                    <% else %>
                      <span class="badge bg-secondary"><%= t('bo.common.status.inactive') %></span>
                    <% end %>
                  </td>
                  <td>
                    <div class="dropdown">
                      <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                          <%= link_to edit_bo_product_variant_path(params[:org_slug], @product, variant), class: "dropdown-item" do %>
                            <i class="fa-solid fa-pen me-2"></i> <%= t('bo.common.actions.edit') %>
                          <% end %>
                        </li>
                        <% unless variant.is_default? || variant.order_items.any? %>
                          <li><hr class="dropdown-divider"></li>
                          <li>
                            <%= button_to bo_product_variant_path(params[:org_slug], @product, variant), method: :delete, class: "dropdown-item text-danger", data: { turbo_confirm: t('bo.common.confirm.delete_variant') } do %>
                              <i class="fa-solid fa-trash me-2"></i> <%= t('bo.common.actions.delete') %>
                            <% end %>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>
  </div>
</div>

<% end %>
